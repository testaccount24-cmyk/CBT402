/* REXX */
CVT      = C2D(STORAGE(10,4))
SMCA     = STORAGE(D2X(CVT + 196),4)
SMCA     = C2D(BITAND(SMCA,'7FFFFFFF'X))

SMFID    = STRIP(STORAGE(D2X(SMCA + 16),4),T)
SMCAFRDS = C2D(STORAGE(D2X(SMCA+244),4))
SMCALRDS = C2D(STORAGE(D2X(SMCA+248),4))

SAY 'CURRENT SMF STATUS ON ' SMFID 'AS ON : ' DATE('U') TIME()
SAY COPIES('-',79)
HEADING = LEFT('DATASET',45)||LEFT('VOLUME',7)||LEFT('SIZE',8)||,
          LEFT('%FULL',5)||LEFT(' STATUS',8)
SAY HEADING
SAY COPIES('-',79)

RDSNEXT  = SMCAFRDS
DO WHILE (SMCALRDS <> RDSNEXT)
     RDSNAME  = STORAGE(D2X(RDSNEXT+16),44)
     RDSVOL   = STORAGE(D2X(RDSNEXT+60),6)
     RDSCAP   =  C2D(STORAGE(D2X(RDSNEXT+76),4))
     RDSCAPA  =  FORMAT(C2D(STORAGE(D2X(RDSNEXT+80),4)),7,0)
     PERCENT  =  FORMAT((RDSCAPA*100/RDSCAP),3,0)
     RDSFLAG1 = C2X(STORAGE(D2X(RDSNEXT+12),1))
     SELECT
        WHEN RDSFLAG1 = '00' THEN
             STATUS   = 'ACTIVE'
        WHEN RDSFLAG1 = '04' THEN
             STATUS   = 'ALTERNATE'
        WHEN RDSFLAG1 = '08' THEN
             STATUS   = 'DUMP REQUIRED'
        OTHERWISE
             STATUS   = 'NOT NORMAL'
     END
     RDSNEXT = C2D(STORAGE(D2X(RDSNEXT+4),4))
     SAY RDSNAME RDSVOL RDSCAP PERCENT STATUS
END
SAY COPIES(' ',79)
EXIT
